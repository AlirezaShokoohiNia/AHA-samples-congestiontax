# Business Requirements – Congestion Tax System

---

### ۱. پیش‌زمینه
شهرهایی مانند گوتنبرگ برای کاهش ترافیک و آلودگی، مالیات ترافیک شهری (Congestion Tax) وضع می‌کنند.  
شهرداری نیازمند سامانه‌ای قابل اعتماد برای محاسبه و اعمال این هزینه‌ها در ساعات مشخص ورود و خروج خودروها است.

### ۲. اهداف
- ثبت عبور خودروها همراه با زمان و نام شهر.  
- محاسبه هزینه مالیات ترافیک بر اساس قوانین خاص هر شهر.  
- اعمال معافیت‌ها و سقف روزانه.  
- پشتیبانی از چندین شهر با مجموعه قوانین متفاوت که به صورت خارجی مدیریت می‌شوند.

### ۳. قوانین اصلی (نمونه گوتنبرگ)

#### ۳.۱ هزینه‌های زمان‌بندی‌شده
- بازه‌های زمانی ثابت با هزینه مشخص (SEK).  
- مثال: ۰۶:۰۰–۰۶:۲۹ → ۸ کرون، ۰۷:۰۰–۰۷:۵۹ → ۱۸ کرون.

#### ۳.۲ سقف روزانه
- حداکثر هزینه برای هر خودرو در یک روز: **۶۰ کرون**.

#### ۳.۳ معافیت‌ها
- عدم دریافت مالیات در آخر هفته (شنبه و یکشنبه).  
- عدم دریافت مالیات در تعطیلات رسمی و روز قبل از تعطیلات.  
- عدم دریافت مالیات در ماه ژوئیه.  
- دسته‌های خودرو معاف: امدادی، اتوبوس، دیپلماتیک، موتورسیکلت، نظامی، خارجی.

#### ۳.۴ قانون تک‌هزینه
- اگر یک خودرو در مدت ۶۰ دقیقه چند بار از ایستگاه‌های عوارض عبور کند، تنها بالاترین هزینه اعمال می‌شود.

### ۴. نیازمندی‌ها

#### ۴.۱ عملکردی
- ثبت عبور خودرو با پلاک، شهر و زمان.  
- دریافت مجموعه قوانین مربوط به شهر در زمان اجرا.  
- محاسبه هزینه روزانه هر خودرو با اعمال معافیت‌ها و سقف.  
- ذخیره نتایج برای ممیزی و گزارش‌گیری.

#### ۴.۲ غیرعملکردی
- **درستی:** باید دقیقاً مطابق قوانین شهری باشد.  
- **قابلیت توسعه:** پشتیبانی از شهرهای جدید با قوانین متفاوت.  
- **قابلیت نگهداری:** قوانین باید به صورت خارجی ذخیره شوند (JSON، پایگاه داده، Redis، API).  
- **قابلیت تست:** قوانین باید با تست‌های خودکار اعتبارسنجی شوند.

### ۵. برون‌سپاری قوانین
- مجموعه قوانین خارج از برنامه ذخیره می‌شوند (مثلاً فایل‌های JSON).  
- هر شهر فایل مخصوص خود را دارد: `/rules/{city}.rules.json`.  
- ویراستاران محتوا می‌توانند قوانین را بدون نیاز به انتشار مجدد تغییر دهند.  
- در آینده می‌توان از Redis، پایگاه داده یا API استفاده کرد.

### ۶. خروجی‌ها
- کدبیس تمیز و مبتنی بر دامنه (DDD) که قوانین فوق را پیاده‌سازی کند.  
- تست‌های خودکار برای دامنه، لایه کاربردی، زیرساخت و API.  
- مستندات معماری و فرمت مجموعه قوانین.
